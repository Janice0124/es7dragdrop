<!-- Started 1/17/2017
	Last edit: 1/17/2017
	Use javascript to create .aia file like the ones 
	existing App Inventor .aia files have
-->

<html>
<head>
	<!--<script src="/Users/Janice/Documents/AppInventor/Stuk-jszip-5250332/dist/jszip.js"></script>
-->
	<script type="text/javascript" src="jszip.js"></script>
	<script type="text/javascript" src="FileSaver.js"></script>

</head>
 
<body>
	<input type="button" onclick="create_zip()" value="Create Zip File"></input>
<script>

function create_zip() {

	var zip = new JSZip();
	
	var projZip = zip.folder("youngandroidproject");
	projZip.file("project.properties", "main=appinventor.ai_janicec124.Hello.Screen1\nname=Hello\nassets=../assets\nsource=../src\nbuild=../build\nversioncode=1\nversionname=1.0\nuseslocation=False\naname=Hello\nsizing=Fixed");
	
	var helloZip = zip.folder("src").folder("appinventor").folder("ai_janicec124").folder("Hello");
	helloZip.file("Screen1.bky", '<xml xmlns="http://www.w3.org/1999/xhtml">\n  <block type="component_event" id="1" x="1" y="1">\n    <mutation component_type="Button" instance_name="Button1" event_name="Click"></mutation>\n    <field name="COMPONENT_SELECTOR">Button1</field>\n  </block>\n  <yacodeblocks ya-version="158" language-version="20"></yacodeblocks>\n</xml>');
	helloZip.file("Screen1.scm", '#|\n$JSON\n{"authURL":["ai2.appinventor.mit.edu"],"YaVersion":"158","Source":"Form","Properties":{"$Name":"Screen1","$Type":"Form","$Version":"19","AppName":"Hello","Title":"Screen1","Uuid":"0","$Components":[{"$Name":"Button1","$Type":"Button","$Version":"6","Text":"Hello","Uuid":"1216449460"}]}}\n|#');

	// Works but downloads "Unknown" file - can't change name
	// zip.generateAsync({type:"base64"}).then(function (base64) {
	//     location.href="data:application/zip;base64," + base64;
	// });

	// Doesn't work in Safari - only works in Chrome
	// Can define file name - just change to .zip or .aia
	zip.generateAsync({type:"blob"})
	.then(function (blob) {
	    saveAs(blob, "Hello.aia");
	});
}

</script>
</body>

</html>